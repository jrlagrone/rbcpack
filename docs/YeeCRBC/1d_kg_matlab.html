<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1D Klein-Gordon &#8212; RBCPack  documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2D Wave Equation" href="2d_wave_matlab.html" />
    <link rel="prev" title="Implementation Examples in Matlab" href="matlab_examples.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          rbcpack</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Components <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Yee/FDTD</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#downloads-and-respository">Downloads and Respository</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#acknowledgments">Acknowledgments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/index.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Utilities/index.html#optimal-cosines">Optimal Cosines</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contrib.html">rbcpack Contributors</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Current Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">1D Klein-Gordon</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#what-this-program-does">What this program does</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-commented-program">The commented program</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="matlab_examples.html" title="Previous Chapter: Implementation Examples in Matlab"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Implementatio...</span>
    </a>
  </li>
  <li>
    <a href="2d_wave_matlab.html" title="Next Chapter: 2D Wave Equation"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">2D Wave Equation &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">  <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Yee/FDTD</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#downloads-and-respository">Downloads and Respository</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#licensing">Licensing</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#documentation">Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#user-guides">User Guides</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#known-issues">Known Issues</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#theory-results-and-publications">Theory, Results, and Publications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#acknowledgments">Acknowledgments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Utilities/index.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Utilities/index.html#optimal-cosines">Optimal Cosines</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contrib.html">rbcpack Contributors</a></li>
</ul>

<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="d-klein-gordon">
<h1>1D Klein-Gordon<a class="headerlink" href="#d-klein-gordon" title="Permalink to this headline">¶</a></h1>
<p>This tutorial explains the code <a class="reference external" href="https://github.com/jrlagrone/rbcpack/blob/main/YeeCRBC/Matlab/klein_gordon_1d_DAB.m">klein_gordon_1d_DAB.m</a> and requires the use of <a class="reference external" href="https://github.com/jrlagrone/rbcpack/blob/main/YeeCRBC/Matlab/optimal_cosines.m">optimal_cosines.m</a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This Matlab code implements a second order finite difference approximation to
the 1D Klien-Gordon equation. On one side, the grid is terminated with a Double
Absorbing Boundary (DAB).</p>
<p>We use the Klein-Gordon equation instead of the wave equation because the
Sommerfeld radiation condition is the correct boundary condition for the wave
equation in 1D. For Klein-Gordon, dispersion results in waves moving at different
speeds, which means Sommerfeld is no longer exact and the benefits of the DAB can
be better illustrated.</p>
<div class="section" id="what-this-program-does">
<h3>What this program does<a class="headerlink" href="#what-this-program-does" title="Permalink to this headline">¶</a></h3>
<p>For this example, we consider the 1D Klein-Gordon equation,</p>
<div class="math notranslate nohighlight">
\begin{align}
  \frac{d^2 u}{d t^2} &amp;= c^2 \frac{d^2 u}{d x^2} - s u,
\end{align}</div><p>where <span class="math notranslate nohighlight">\(c&gt;0\)</span> and <span class="math notranslate nohighlight">\(s&gt;0\)</span>.</p>
<p>For this example, we will impose Dirichlet boundary conditions on the left and
truncate the domain on the right with a DAB. We will use zero initial conditions.</p>
<div class="math notranslate nohighlight">
\begin{align}
  u(x,0) = 0, \\
  \frac{du}{dt}(x,0) = 0, \\
  u(0,t) = 0,
\end{align}</div><p id="discretization">We discretize this equation using second order finite differences on the
domain <span class="math notranslate nohighlight">\([0, 1]\)</span> with mesh spacing of <span class="math notranslate nohighlight">\(\Delta x\)</span> and we define</p>
<div class="math notranslate nohighlight">
\begin{align}
  x_i &amp;=  i\Delta x, \qquad i=0,...,n-1.
\end{align}</div><p>We choose a time step size, <span class="math notranslate nohighlight">\(\Delta t\)</span>, satisfying</p>
<div class="math notranslate nohighlight">
\begin{align}
  \Delta t \leq \frac{dx}{c}.
\end{align}</div><p>Letting</p>
<div class="math notranslate nohighlight">
\begin{align}
  t_n = n \Delta t,
\end{align}</div><p><span class="math notranslate nohighlight">\(u\)</span> is on the grid by:</p>
<div class="math notranslate nohighlight">
\begin{align}
  \frac{u(x_i,t_{n-1}) - 2u(x_i,t_{n}) + u(x_i,t_{n+1})}{\Delta t}
  = c\left( \frac{u(x_{i-1},t_{n}) - 2u(x_i,t_{n}) + u(x_{i+1},t_{n})}{\Delta x} \right)
  - s u(x_i,t_{n})
\end{align}</div><p>We use the discretization of the DAB described in <a class="reference internal" href="theory_overview.html#dab-discretization"><span class="std std-ref">theory overview</span></a></p>
<p>We drive the simulation with a point source that takes the form of
a differentiated Gaussian.</p>
</div>
</div>
<div class="section" id="the-commented-program">
<h2>The commented program<a class="headerlink" href="#the-commented-program" title="Permalink to this headline">¶</a></h2>
<p>We begin by choosing some basic simulation parameters. First we choose the number
of grid points to use in the discetization. Then we choose the number of grid
points to extend the domain by so we can compare to a larger simulation to check
error. In this case, we use 500 grid points and extend the larger simulation by
600 grid points, which corresponds to running on the domain [0,2.2]. Then, we
choose the problem and source parameters.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% domain parameters</span>
<span class="n">n</span> <span class="p">=</span> <span class="mi">500</span><span class="p">;</span>           <span class="c">% number of grid points in domain [0,1]</span>
<span class="n">m</span> <span class="p">=</span> <span class="mi">600</span><span class="p">;</span>           <span class="c">% number of grid points to extent the domain by for a reference</span>
                   <span class="c">% solution using a larger simulation</span>
<span class="n">s</span> <span class="p">=</span> <span class="mi">25</span><span class="p">;</span>            <span class="c">% dispersion parameter</span>
<span class="n">c</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>             <span class="c">% wave speed</span>
<span class="n">nsteps</span> <span class="p">=</span> <span class="mi">1500</span><span class="p">;</span>     <span class="c">% number of time steps</span>
<span class="n">cfl</span> <span class="p">=</span> <span class="mf">0.99</span><span class="p">;</span>        <span class="c">% cfl ratio</span>

<span class="c">% compute grid spacing / time step</span>
<span class="n">dx</span> <span class="p">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">dt</span> <span class="p">=</span> <span class="n">cfl</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">c</span><span class="p">;</span>

<span class="c">% source paramters</span>
<span class="n">tw</span> <span class="p">=</span> <span class="mi">25</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>             <span class="c">% pulse width</span>
<span class="n">t0</span> <span class="p">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">tw</span><span class="p">;</span>              <span class="c">% pulse delay (roughly need t0 &gt; 4*tw to be smooth)</span>
<span class="n">amp</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>                <span class="c">% pulse &quot;amplitude&quot;</span>
<span class="n">sloc</span> <span class="p">=</span> <span class="mi">90</span><span class="p">;</span>              <span class="c">% source location</span>
</pre></div>
</div>
<p>Next, we choose the DAB parameters. We choose the number of recursions to use,
<span class="math notranslate nohighlight">\(p\)</span> and how wide the DAB layer should be in grid points. We require at
least three points to support the update to the Klein-Gordon equation. For
efficiency and accuracy, 3 is the best choice; however, if the auxiliary variables
are to be plotted, increasing the thickness is desireable.</p>
<p>We present two ways to choose the parameter values, the first is simplistic and
sets all of the values to either 1 or 0. This generally works well for short
times. The alternative is to choose the optimal parameters, which provide an
error estimate valid until the provided time.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% DAB parameters</span>
<span class="n">p</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>                  <span class="c">% DAB/CRBC order</span>
<span class="n">ndab</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>               <span class="c">% DAB width</span>
<span class="c">% a = ones(p,1);          % choose all the cosines to be one for simplicity</span>
<span class="c">% ab = ones(p,1);         % choose all the cosines to be one for simplicity</span>
<span class="c">% sig = zeros(p,1);       % choose all the sigmas to be zero for simplicity</span>
<span class="c">% sigb = zeros(p,1);      % choose all the sigmas to be zero for simplicity</span>

<span class="c">% ... or use optimal cosines</span>
<span class="n">T</span> <span class="p">=</span> <span class="n">nsteps</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
<span class="n">eta</span> <span class="p">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">sloc</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">T</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">[</span><span class="n">at</span> <span class="n">errest</span><span class="p">]</span> <span class="p">=</span> <span class="n">optimal_cosines</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">a</span> <span class="p">=</span> <span class="n">at</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">);</span>
  <span class="n">ab</span> <span class="p">=</span> <span class="n">at</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">);</span>
  <span class="n">sig</span> <span class="p">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="o">.*</span><span class="n">a</span><span class="p">)</span> <span class="o">./</span> <span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">a</span><span class="p">);</span>
  <span class="n">sigb</span> <span class="p">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ab</span><span class="o">.*</span><span class="n">ab</span><span class="p">)</span> <span class="o">./</span> <span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="n">ab</span><span class="p">);</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Next, we allocate the storage for all of the field values and auxiliary variables
we will use.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% allocate storage</span>
<span class="n">unew</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="c">% field values</span>
<span class="n">ucur</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">uold</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="n">runew</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="c">% for larger reference simulation</span>
<span class="n">rucur</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">ruold</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="n">udabnew</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="c">% dab aux. variables</span>
<span class="n">udabcur</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">udabold</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>We begin time stepping by updating all of the internal field values and adding a
source term.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% time step</span>
<span class="k">for</span> <span class="n">t</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">nsteps</span>

  <span class="c">% internal updates --- eqn 54, in DAB paper</span>
  <span class="n">unew</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">ucur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">uold</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ucur</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="n">n</span><span class="p">)</span> <span class="c">...</span>
      <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">ucur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ucur</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">dt</span>^<span class="mi">2</span><span class="o">*</span><span class="n">ucur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

  <span class="c">% reference solution</span>
  <span class="n">runew</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">rucur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ruold</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rucur</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="c">...</span>
      <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">rucur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">rucur</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">dt</span>^<span class="mi">2</span><span class="o">*</span><span class="n">rucur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

  <span class="c">% add source</span>
  <span class="n">unew</span><span class="p">(</span><span class="n">sloc</span><span class="p">)</span> <span class="p">=</span> <span class="n">unew</span><span class="p">(</span><span class="n">sloc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">t</span><span class="o">*</span><span class="n">dt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">)</span><span class="o">*</span><span class="n">amp</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">t</span><span class="o">*</span><span class="n">dt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
  <span class="n">runew</span><span class="p">(</span><span class="n">sloc</span><span class="p">)</span> <span class="p">=</span> <span class="n">runew</span><span class="p">(</span><span class="n">sloc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">t</span><span class="o">*</span><span class="n">dt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">)</span><span class="o">*</span><span class="n">amp</span><span class="o">*</span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">t</span><span class="o">*</span><span class="n">dt</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">tw</span><span class="p">)</span>^<span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p>To begin the DAB update, in all auxiliary variables we use the same update
equation that we use to evolve the interior points.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% perform wave equation update for the interior of the DAB --- eqn 54, in DAB paper</span>
<span class="k">for</span> <span class="n">q</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span>
   <span class="n">udabnew</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="p">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">udabcur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">udabold</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="c">...</span>
       <span class="p">((</span><span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span>^<span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">udabcur</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="n">ndab</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span><span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">udabcur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">+</span><span class="c">...</span>
       <span class="n">udabcur</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ndab</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">dt</span>^<span class="mi">2</span><span class="o">*</span><span class="n">udabcur</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">);</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Next, we copy in the rightmost point that the interior was able to update
into the first level of the auxiliary variables.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% left boundary is correctly set to zero, copy data to DAB boundary for</span>
<span class="c">% the right boundary</span>
<span class="n">udabnew</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">unew</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Now, we run the CRBC recursions in the increasing direction of the auxiliary
index to get updates to the leftmost point in the DAB layer.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% run the &quot;forward&quot; recursion --- from eqn. 60-61 (a=ab=1,sig=sigb=0)</span>
<span class="n">w</span> <span class="p">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span> <span class="o">+</span> <span class="n">c</span><span class="o">/</span><span class="n">dx</span><span class="p">;</span>

<span class="c">% run the &quot;forward&quot; recursion --- from eqn. 60-61, generalized</span>
<span class="k">for</span> <span class="n">q</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">p</span>
    <span class="n">udabnew</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="c">...</span>
        <span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">-</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">-</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">-</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabnew</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabnew</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabnew</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">);</span>
<span class="n">end</span>
</pre></div>
</div>
<p>We begin the CRBC recursions at the rightmost at the highest auxilliary order by
applying the Sommerfeld radiation condition. Then we run the CRBC recursions in
decreasing auxiliary order.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% apply the termination conditon, sommerfeld --- from eqn 56-57</span>
<span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="p">((</span><span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">dt</span> <span class="c">...</span>
    <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">/</span><span class="n">w</span><span class="p">;</span>

<span class="c">% run the &quot;backward&quot; recursions --- from eqn. 58-59, generalized\</span>
<span class="k">for</span> <span class="n">q</span><span class="p">=</span><span class="n">p</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
    <span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="p">=</span> <span class="c">...</span>
        <span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">-</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">-</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabcur</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">-</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">...</span>
        <span class="o">+</span><span class="p">(</span><span class="n">ab</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sigb</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span> <span class="o">+</span> <span class="n">sig</span><span class="p">(</span><span class="n">q</span><span class="p">))</span> <span class="o">*</span> <span class="n">udabnew</span><span class="p">(</span><span class="n">ndab</span><span class="p">,</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="n">end</span>
</pre></div>
</div>
<p>Finally, we copy the updated first level auxiliary variable into the internal
solver.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% copy DAB value back into the field</span>
<span class="n">unew</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">=</span> <span class="n">udabnew</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>We plot the field values and the error by comparing to the larger simulation.
The commented out portion plots the field values and the auxiliary layers (these
plots are clearer if the DAB layer is relatively wide).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>  <span class="c">% figures</span>

  <span class="c">% field and comparison to larger simulation</span>
  <span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">unew</span><span class="p">);</span>
  <span class="n">title</span><span class="p">(</span><span class="s">&#39;field values&#39;</span><span class="p">)</span>
  <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="n">unew</span> <span class="o">-</span> <span class="n">runew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">n</span><span class="p">))</span>
  <span class="n">title</span><span class="p">(</span><span class="s">&#39;Error compared to larger simulation&#39;</span><span class="p">)</span>
  <span class="n">drawnow</span>

  <span class="s">%</span> <span class="s">field</span> <span class="s">and</span> <span class="s">auxiliary</span> <span class="s">fields</span>
<span class="c">% figure(2)</span>
<span class="c">% subplot(1, p+4, 1:3)</span>
<span class="c">% plot(1:n, unew);</span>
<span class="c">% title(&#39;field values&#39;)</span>
<span class="c">% for i=1:p+1</span>
<span class="c">%   subplot(1, p+4, i+3)</span>
<span class="c">%   plot(1:ndab, udabnew(:,i));</span>
<span class="c">%   title(sprintf(&#39;p = %i&#39;, i-1))</span>
<span class="c">% end</span>
<span class="c">% drawnow</span>
</pre></div>
</div>
<p>Lastly, we rotate the storage arrays so we can procede to the next time step.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>  <span class="c">% swap old, new, and current values</span>
  <span class="n">uold</span> <span class="p">=</span> <span class="n">ucur</span><span class="p">;</span>
  <span class="n">ucur</span> <span class="p">=</span> <span class="n">unew</span><span class="p">;</span>

  <span class="n">ruold</span> <span class="p">=</span> <span class="n">rucur</span><span class="p">;</span>
  <span class="n">rucur</span> <span class="p">=</span> <span class="n">runew</span><span class="p">;</span>

  <span class="n">udabold</span> <span class="p">=</span> <span class="n">udabcur</span><span class="p">;</span>
  <span class="n">udabcur</span> <span class="p">=</span> <span class="n">udabnew</span><span class="p">;</span>

<span class="n">end</span>
</pre></div>
</div>
<p class="rubric">References</p>
<ol class="arabic simple" id="bibtex-bibliography-YeeCRBC/1d_kg_matlab-0" start="1">
<li><p>Thomas Hagstrom, Dan Givoli, Daniel Rabinovich, and Jacobo Bielak. The double absorbing boundary method. <em>Journal of Computational Physics</em>, 259(0):220 – 241, 2014.</p></li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/YeeCRBC/1d_kg_matlab.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
    <a href="../contrib.html">rbcpack Contributors </a><br />
        &copy; Copyright 2015-2016, rbcpack.org.<br/>
    </p>
  </div>
</footer>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-71984541-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>
</html>